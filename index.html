<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vibe Goblin Karaoke - Burger Flip Challenge</title>
<style>
  body {
    margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1a1a1a; color: #eee; display: flex; flex-direction: column; align-items: center; min-height: 100vh;
  }
  h1 {
    margin: 1rem 0 0.5rem 0; font-weight: 700; font-size: 2.2rem; color: #9acd32;
    text-shadow: 0 0 10px #7bba00;
  }
  #gameContainer {
    width: 320px; max-width: 95vw; background: #222; border-radius: 10px; padding: 1rem;
    box-shadow: 0 0 20px #7bba00aa;
    display: flex; flex-direction: column; align-items: center;
  }
  #burger {
    width: 150px; height: 150px; font-size: 7rem; line-height: 150px; text-align: center;
    user-select: none; cursor: pointer; margin: 1rem 0; 
    transition: transform 0.6s ease, filter 0.3s ease;
    will-change: transform, filter;
  }
  #burger.flipping {
    animation: flipAnim 0.6s forwards;
  }
  #burger.success {
    filter: drop-shadow(0 0 12px #00ff00);
  }
  #burger.fail {
    animation: shakeAnim 0.5s;
    filter: drop-shadow(0 0 12px #ff0000);
  }
  @keyframes flipAnim {
    0% { transform: rotateY(0deg); }
    50% { transform: rotateY(90deg); }
    100% { transform: rotateY(180deg); }
  }
  @keyframes shakeAnim {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    50% { transform: translateX(10px); }
    75% { transform: translateX(-10px); }
  }

  #barContainer {
    width: 100%; height: 30px; background: #444; border-radius: 15px; overflow: hidden; margin-bottom: 1rem;
  }
  #timeBar {
    height: 100%; background: #9acd32; width: 100%;
    transition: width 0.1s linear;
  }

  #targetZone {
    position: relative; width: 100%; height: 30px; background: #333; border-radius: 8px; margin-bottom: 0.5rem;
    overflow: hidden;
  }
  #targetZone .zone {
    position: absolute; top: 0; height: 100%; background: #7bba00; border-radius: 8px;
    filter: drop-shadow(0 0 6px #7bba00);
    transition: left 0.1s linear;
  }
  #movingBar {
    position: absolute; top: 0; height: 100%; background: #eee; border-radius: 8px;
    opacity: 0.8; filter: drop-shadow(0 0 6px #eee);
    transition: left 0.05s linear;
  }

  #info {
    display: flex; justify-content: space-around; width: 100%; font-weight: 600; font-size: 1rem; margin-bottom: 0.8rem;
    user-select: none;
  }
  #info > div {
    flex: 1; text-align: center; color: #ccc;
  }

  #log {
    height: 80px; overflow-y: auto; font-size: 0.85rem; background: #111; border-radius: 6px;
    padding: 0.5rem; margin-top: 0.5rem; width: 100%; box-sizing: border-box;
    font-family: monospace;
    color: #9acd32;
  }

  #startButton {
    background: #7bba00; border: none; padding: 0.8rem 1.2rem; border-radius: 8px; color: #111;
    font-weight: 700; font-size: 1.2rem; cursor: pointer; user-select: none;
    box-shadow: 0 0 10px #7bba00cc;
    transition: background-color 0.3s ease;
  }
  #startButton:hover:not(:disabled) {
    background: #9acd32;
  }
  #startButton:disabled {
    background: #555;
    cursor: not-allowed;
    box-shadow: none;
  }
</style>
</head>
<body>
<h1>Vibe Goblin Karaoke - Burger Flip Challenge</h1>
<div id="gameContainer" role="main" aria-label="Burger flipping game">
  <div id="burger" tabindex="0" role="button" aria-pressed="false" aria-label="Burger to flip">üçî</div>

  <div id="barContainer" aria-label="Time remaining">
    <div id="timeBar"></div>
  </div>

  <div id="targetZone" aria-label="Target zone for flipping">
    <div class="zone"></div>
    <div id="movingBar"></div>
  </div>

  <div id="info" aria-live="polite">
    <div>Score: <span id="score">0</span></div>
    <div>Combo: <span id="combo">0</span></div>
    <div>Lives: <span id="lives">3</span></div>
  </div>

  <button id="startButton" aria-label="Start game">Start Game</button>

  <pre id="log" aria-live="polite" aria-atomic="true" role="log"></pre>
</div>

<script>
  // Elements
  const burger = document.getElementById('burger');
  const movingBar = document.getElementById('movingBar');
  const targetZoneDiv = document.querySelector('#targetZone .zone');
  const timeBar = document.getElementById('timeBar');
  const scoreEl = document.getElementById('score');
  const comboEl = document.getElementById('combo');
  const livesEl = document.getElementById('lives');
  const startBtn = document.getElementById('startButton');
  const logEl = document.getElementById('log');

  // Game variables
  let score = 0;
  let combo = 0;
  let lives = 3;
  let gameActive = false;

  let targetZone = { leftPercent: 40, widthPercent: 20 };
  let movingBarPos = 0;
  let movingBarSpeed = 0.8; // % per frame
  let movingBarDirection = 1;

  let timeLimit = 15_000; // 15 seconds game length
  let startTime = 0;
  let animationFrameId;

  function logMessage(msg) {
    logEl.textContent = msg + "\n" + logEl.textContent;
  }

  // Initialize UI
  function updateUI() {
    scoreEl.textContent = score;
    comboEl.textContent = combo;
    livesEl.textContent = lives;
  }

  function randomizeTargetZone() {
    targetZone.widthPercent = 20 + Math.random() * 15; // 20% to 35%
    targetZone.leftPercent = Math.random() * (100 - targetZone.widthPercent);
    targetZoneDiv.style.left = targetZone.leftPercent + '%';
    targetZoneDiv.style.width = targetZone.widthPercent + '%';
  }

  function resetMovingBar() {
    movingBarPos = 0;
    movingBarDirection = 1;
    movingBar.style.width = '25%';
    movingBar.style.left = movingBarPos + '%';
  }

  function moveMovingBar() {
    movingBarPos += movingBarSpeed * movingBarDirection;
    if (movingBarPos + 25 > 100) movingBarDirection = -1;
    if (movingBarPos < 0) movingBarDirection = 1;
    movingBar.style.left = movingBarPos + '%';
  }

  function updateTimeBar() {
    const elapsed = Date.now() - startTime;
    const remaining = Math.max(0, timeLimit - elapsed);
    const widthPercent = (remaining / timeLimit) * 100;
    timeBar.style.width = widthPercent + '%';

    if (remaining <= 0) {
      endGame();
    }
  }

  function flipBurger() {
    if (!gameActive) return;

    // Add flipping animation
    burger.classList.add('flipping');

    setTimeout(() => {
      burger.classList.remove('flipping');
    }, 600);

    const movingBarLeft = movingBarPos;
    const movingBarWidthPercent = parseFloat(movingBar.style.width) || 25;
    const movingBarRight = movingBarLeft + movingBarWidthPercent;
    const targetLeft = targetZone.leftPercent;
    const targetRight = targetZone.leftPercent + targetZone.widthPercent;

    // Calculate overlap between movingBar and targetZone
    const overlap = Math.min(movingBarRight, targetRight) - Math.max(movingBarLeft, targetLeft);

    if (overlap > 0) {
      combo++;
      score += 10 * combo;
      logMessage(`üü¢ Perfect flip! Combo x${combo}`);

      burger.classList.add('success');
      setTimeout(() => {
        burger.classList.remove('success');
      }, 500);

      randomizeTargetZone();
      resetMovingBar();
    } else {
      lives--;
      combo = 0;
      logMessage(`üî¥ Missed! Lives left: ${lives}`);

      burger.classList.add('fail');
      setTimeout(() => {
        burger.classList.remove('fail');
      }, 500);
    }
    updateUI();

    if (lives <= 0) {
      endGame();
    }
  }

  function gameLoop() {
    if (!gameActive) return;
    moveMovingBar();
    updateTimeBar();
    animationFrameId = requestAnimationFrame(gameLoop);
  }

  function startGame() {
    score = 0;
    combo = 0;
    lives = 3;
    gameActive = true;
    startTime = Date.now();

    randomizeTargetZone();
    resetMovingBar();
    updateUI();
    timeBar.style.width = '100%';
    logMessage('üõ† Game started! Flip the burger when the moving bar hits the green zone.');
    startBtn.disabled = true;
    burger.setAttribute('aria-pressed', 'false');
    burger.focus();

    animationFrameId = requestAnimationFrame(gameLoop);
  }

  function endGame() {
    gameActive = false;
    cancelAnimationFrame(animationFrameId);
    logMessage(`üèÅ Game over! Final score: ${score}`);
    startBtn.disabled = false;
  }

  // Controls
  burger.addEventListener('click', () => flipBurger());
  burger.addEventListener('keydown', e => {
    if (e.key === ' ' || e.key === 'Enter') {
      e.preventDefault();
      flipBurger();
    }
  });

  startBtn.addEventListener('click', startGame);

  // Accessibility: focus ring on burger when tabbing
  burger.addEventListener('focus', () => {
    burger.style.outline = '3px solid #9acd32';
  });
  burger.addEventListener('blur', () => {
    burger.style.outline = 'none';
  });
</script>
</body>
</html>
