<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vibe Goblin: Flip Frenzy</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(to bottom, #1e1e2f, #0a0a14);
      color: #efeefe;
      text-align: center;
      overflow-x: hidden;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    h1 {
      margin: 20px 0 10px;
      font-size: 2.2em;
      text-shadow: 0 0 6px #7aff90;
      user-select: none;
    }
    #gameArea {
      position: relative;
      flex-grow: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 10px;
      max-width: 480px;
      margin: 0 auto;
      width: 100%;
    }
    #burger {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(145deg, #3bbf6f, #2b974f);
      box-shadow:
        inset 0 8px 15px #5ce182,
        0 5px 10px rgba(0,0,0,0.7);
      cursor: pointer;
      transition: transform 0.25s ease, background 0.3s ease;
      user-select: none;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    #burger:active {
      transform: scale(0.9);
    }
    #burger.flipped {
      animation: flipAnim 0.5s ease forwards;
    }
    @keyframes flipAnim {
      0% { transform: rotateX(0) scale(1); }
      50% { transform: rotateX(360deg) scale(1.3); }
      100% { transform: rotateX(0) scale(1); }
    }
    #startButton, #pauseButton, #restartButton, #shareButton {
      margin: 10px 8px 20px 8px;
      padding: 12px 26px;
      font-size: 1.1em;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      user-select: none;
      transition: background-color 0.3s ease;
      box-shadow: 0 0 10px #42f4a0;
      color: #0a0a0a;
    }
    #startButton {
      background-color: #7fff7f;
    }
    #startButton:hover {
      background-color: #52d852;
    }
    #pauseButton {
      background-color: #ffa500;
      display: none;
    }
    #pauseButton:hover {
      background-color: #e08c00;
    }
    #restartButton {
      background-color: #ff6464;
      display: none;
    }
    #restartButton:hover {
      background-color: #e03232;
    }
    #shareButton {
      background-color: #42aaff;
      display: none;
    }
    #shareButton:hover {
      background-color: #1578e0;
    }
    #score, #timer, #combo, #lives, #highScore {
      font-size: 1.4em;
      margin: 6px 0;
      user-select: none;
      text-shadow: 0 0 6px #7aff90;
    }
    #timeBarContainer {
      width: 90%;
      height: 22px;
      background: #222;
      margin: 20px auto 50px;
      border-radius: 15px;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 0 10px #0a5f2e;
      max-width: 480px;
    }
    #movingBar {
      position: absolute;
      height: 100%;
      width: 15%;
      background: #3bbf6f;
      border-radius: 15px;
      left: 0;
      animation: moveBar 2s linear infinite paused;
      box-shadow: 0 0 15px #3bbf6f;
    }
    #targetZone {
      position: absolute;
      height: 100%;
      width: 20%;
      background: rgba(255,255,255,0.15);
      border: 3px solid #7aff90;
      top: 0;
      left: 40%;
      border-radius: 15px;
      pointer-events: none;
      box-shadow: 0 0 10px #7aff90 inset;
    }
    @keyframes moveBar {
      0% { left: 0%; }
      50% { left: 85%; }
      100% { left: 0%; }
    }
    /* Flash green for perfect */
    .perfect-flash {
      animation: flashGreen 0.4s ease;
    }
    @keyframes flashGreen {
      0%, 100% { box-shadow: 0 0 20px #00ff00; }
      50% { box-shadow: 0 0 50px #7fff7f; }
    }
    /* Flash red for miss */
    .miss-flash {
      animation: flashRed 0.4s ease;
    }
    @keyframes flashRed {
      0%, 100% { box-shadow: 0 0 20px #ff0000; }
      50% { box-shadow: 0 0 50px #ff7f7f; }
    }
  </style>
</head>
<body>
  <h1>üçî Vibe Goblin: Flip Frenzy</h1>

  <div id="timeBarContainer" aria-label="Timing bar with moving indicator and target zone">
    <div id="targetZone" aria-hidden="true"></div>
    <div id="movingBar"></div>
  </div>

  <div id="gameArea" role="main">
    <div id="burger" role="button" tabindex="0" aria-pressed="false" aria-label="Flip the burger"></div>
  </div>

  <div id="score" aria-live="polite">Score: 0</div>
  <div id="combo" aria-live="polite">Combo: 0</div>
  <div id="lives" aria-live="polite">Lives: 3</div>
  <div id="timer" aria-live="polite">Time: 10s</div>
  <div id="highScore" aria-live="polite"></div>

  <div>
    <button id="startButton">Start Game</button>
    <button id="pauseButton" aria-pressed="false">Pause</button>
    <button id="restartButton">Restart</button>
    <button id="shareButton" style="display:none;">Share Score</button>
  </div>

  <audio id="soundPerfect" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
  <audio id="soundNormal" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>
  <audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_d5d63956c6.mp3?filename=ambient-chill-11291.mp3" preload="auto" loop></audio>

  <script>
    const burger = document.getElementById('burger');
    const startButton = document.getElementById('startButton');
    const pauseButton = document.getElementById('pauseButton');
    const restartButton = document.getElementById('restartButton');
    const shareButton = document.getElementById('shareButton');
    const timerDisplay = document.getElementById('timer');
    const scoreDisplay = document.getElementById('score');
    const comboDisplay = document.getElementById('combo');
    const livesDisplay = document.getElementById('lives');
    const highScoreDisplay = document.getElementById('highScore');
    const movingBar = document.getElementById('movingBar');
    const timeBarContainer = document.getElementById('timeBarContainer');
    const targetZone = document.getElementById('targetZone');
    const soundPerfect = document.getElementById('soundPerfect');
    const soundNormal = document.getElementById('soundNormal');
    const bgMusic = document.getElementById('bgMusic');

    let time = 10;
    let score = 0;
    let combo = 0;
    let lives = 3;
    let gameActive = false;
    let paused = false;
    let countdownInterval;
    let speed = 2000; // initial bar animation duration in ms

    // Load high score from localStorage
    let highScore = localStorage.getItem('vibegoblinHighScore') || 0;
    highScoreDisplay.textContent = `High Score: ${highScore}`;

    // Animate moving bar with adjustable speed
    function setMovingBarSpeed(ms) {
      movingBar.style.animationDuration = `${ms}ms`;
    }

    function startMovingBar() {
      movingBar.style.animationPlayState = 'running';
    }
    function pauseMovingBar() {
      movingBar.style.animationPlayState = 'paused';
    }

    // Calculate if moving bar overlaps target zone
    function getPercent(elem) {
      return parseFloat(window.getComputedStyle(elem).left);
    }

    function getWidthPercent(elem) {
      const px = parseFloat(window.getComputedStyle(elem).width);
      const parentPx = elem.parentElement.clientWidth;
      return (px / parentPx) * 100;
    }

    function isInTargetZone() {
      const barLeft = getPercent(movingBar);
      const barWidth = getWidthPercent(movingBar);
      const targetLeft = getPercent(targetZone);
      const targetWidth = getWidthPercent(targetZone);

      const barRight = barLeft + barWidth;
      const targetRight = targetLeft + targetWidth;

      return !(barRight < targetLeft || barLeft > targetRight);
    }

    // Update all displays
    function updateUI() {
      timerDisplay.textContent = `Time: ${time}s`;
      scoreDisplay.textContent = `Score: ${score}`;
      comboDisplay.textContent = `Combo: ${combo}`;
      livesDisplay.textContent = `Lives: ${lives}`;
    }

    // Vibrate device if supported
    function vibrate(ms) {
      if (navigator.vibrate) {
        navigator.vibrate(ms);
      }
    }

    function flashEffect(type) {
      burger.classList.remove('perfect-flash', 'miss-flash');
      void burger.offsetWidth; // trigger reflow
      burger.classList.add(type);
    }

    function playSound(sound) {
      sound.currentTime = 0;
      sound.play().catch(() => {});
    }

    function endGame() {
      gameActive = false;
      pauseMovingBar();
      clearInterval(countdownInterval);
      burger.style.pointerEvents = 'none';
      startButton.disabled = false;
      pauseButton.style.display = 'none';
      restartButton.style.display = 'inline-block';
      shareButton.style.display = 'inline-block';

      if (score > highScore) {
        highScore = score;
        localStorage.setItem('vibegoblinHighScore', highScore);
        highScoreDisplay.textContent = `High Score: ${highScore} üéâ`;
      }

      alert(`‚è∞ Game Over! Your final score: ${score}`);
    }

    function startGame() {
      if (gameActive) return;
      score = 0;
      combo = 0;
      lives = 3;
      time = 10;
      speed = 2000;
      gameActive = true;
      paused = false;

      updateUI();
      burger.style.pointerEvents = 'auto';
      startButton.disabled = true;
      pauseButton.style.display = 'inline-block';
      restartButton.style.display = 'none';
      shareButton.style.display = 'none';

      bgMusic.volume = 0.25;
      bgMusic.play().catch(() => {});

      setMovingBarSpeed(speed);
      startMovingBar();

      pauseButton.textContent = 'Pause';
      pauseButton.setAttribute('aria-pressed', 'false');

      countdownInterval = setInterval(() => {
        if (paused) return;

        time--;
        updateUI();

        // Increase difficulty by speeding up bar every 3 seconds, min 600ms
        if (time % 3 === 0 && speed > 600) {
          speed -= 250;
          setMovingBarSpeed(speed);
        }

        if (time <= 0 || lives <= 0) {
          endGame();
        }
      }, 1000);
    }

    burger.addEventListener('click', () => {
      if (!gameActive || paused || time <= 0) return;

      if (isInTargetZone()) {
        // Perfect flip
        combo++;
        score += 2 * combo;
        flashEffect('perfect-flash');
        playSound(soundPerfect);
        vibrate(50);
      } else {
        // Miss flip
        combo = 0;
        lives--;
        score += 0; // no points for miss
        flashEffect('miss-flash');
        playSound(soundNormal);
        vibrate(100);
      }
      updateUI();

      burger.classList.add('flipped');
      setTimeout(() => {
        burger.classList.remove('flipped');
      }, 500);
    });

    pauseButton.addEventListener('click', () => {
      if (!gameActive) return;

      paused = !paused;
      if (paused) {
        pauseMovingBar();
        pauseButton.textContent = 'Resume';
        pauseButton.setAttribute('aria-pressed', 'true');
        bgMusic.pause();
      } else {
        startMovingBar();
        pauseButton.textContent = 'Pause';
        pauseButton.setAttribute('aria-pressed', 'false');
        bgMusic.play().catch(() => {});
      }
    });

    restartButton.addEventListener('click', () => {
      endGame();
      startGame();
    });

    startButton.addEventListener('click', startGame);

    shareButton.addEventListener('click', () => {
      const shareText = `I scored ${score} points playing Vibe Goblin: Flip Frenzy! Can you beat me? #VibeGoblinGame`;
      if (navigator.share) {
        navigator.share({
          title: 'Vibe Goblin: Flip Frenzy',
          text: shareText,
          url: window.location.href
        }).catch(() => {
          alert('Sharing failed or cancelled.');
        });
      } else {
        // fallback: copy text to clipboard
        navigator.clipboard.writeText(shareText).then(() => {
          alert('Score copied! Share it on Farcaster or anywhere you like.');
        });
      }
    });

    // Accessibility: allow burger flip by keyboard (space or enter)
    burger.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        burger.click();
      }
    });

    // Initialize UI
    updateUI();

  </script>
</body>
</html>
